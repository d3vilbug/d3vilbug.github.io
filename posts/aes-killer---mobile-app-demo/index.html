<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="https://d3vilbug.github.io/js/bundle.min.7750550c0319f5de56d916b91e642bf72a5bd09ee50b201dc2ed9db69d6177a8.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=https://d3vilbug.github.io/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Abdul Wahab - Decrypting Mobile App Traffic using AES Killer and Frida</title>
<meta property="og:title" content=Abdul&#32;Wahab&#32;-&#32;Decrypting&#32;Mobile&#32;App&#32;Traffic&#32;using&#32;AES&#32;Killer&#32;and&#32;Frida />
<meta name="twitter:title" content=Abdul&#32;Wahab&#32;-&#32;Decrypting&#32;Mobile&#32;App&#32;Traffic&#32;using&#32;AES&#32;Killer&#32;and&#32;Frida />
<meta itemprop="name" content=Abdul&#32;Wahab&#32;-&#32;Decrypting&#32;Mobile&#32;App&#32;Traffic&#32;using&#32;AES&#32;Killer&#32;and&#32;Frida />
<meta name="application-name" content=Abdul&#32;Wahab&#32;-&#32;Decrypting&#32;Mobile&#32;App&#32;Traffic&#32;using&#32;AES&#32;Killer&#32;and&#32;Frida />
<meta property="og:site_name" content="Abdul Wahab" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://d3vilbug.github.io/posts/aes-killer---mobile-app-demo/" />
<link rel="canonical" href="https://d3vilbug.github.io/posts/aes-killer---mobile-app-demo/" itemprop="url" />
<meta name="url" content="https://d3vilbug.github.io/posts/aes-killer---mobile-app-demo/" />
<meta name="twitter:url" content="https://d3vilbug.github.io/posts/aes-killer---mobile-app-demo/" />
<meta property="og:url" content="https://d3vilbug.github.io/posts/aes-killer---mobile-app-demo/" />


<meta property="og:updated_time" content="2021-04-19T00:00:00Z" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://d3vilbug.github.io/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



  
    <meta name="twitter:site" content="@d3vilbug" />
    <meta name="twitter:creator" content="@d3vilbug" />

<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Abdul Wahab" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.149.0">


    
    

<link type="text/css" rel="stylesheet" href="https://d3vilbug.github.io/css/bundle.min.1446c0a2aa5d7731282d77cd6e4264eb8d63be7a101ca12b7e5fc5ac8fc51514.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://d3vilbug.github.io/">
                <img src="https://avatars.githubusercontent.com/u/13887305" alt="brand image">
            </a>
        
        
            <a href="https://d3vilbug.github.io/">
                <h1>Abdul Wahab</h1>
            </a>
        
    </h1>
    <p class="lead">
    n00b - wanna be a hacker one day
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="https://d3vilbug.github.io/Posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet" style="text-decoration: none;">
                                <a href="https://d3vilbug.github.io/posts/witcher-guide/">= Witcher: Your Friendly Guide to Setting It Up in Your Environment</a>
                            </li>
                        
                            <li class="bullet" style="text-decoration: none;">
                                <a href="https://d3vilbug.github.io/posts/witcher/">= Witcher: Managing GitHub Advanced Security (GHAS) Controls at Scale</a>
                            </li>
                        
                            <li class="bullet" style="text-decoration: none;">
                                <a href="https://d3vilbug.github.io/posts/sreplay/">= SRePlay - Replay Protection Bypass</a>
                            </li>
                        
                            <li class="bullet" style="text-decoration: none;">
                                <a href="https://d3vilbug.github.io/posts/aes-killer---mobile-app-demo/">= Decrypting Mobile App Traffic using AES Killer and Frida</a>
                            </li>
                        
                            <li class="bullet" style="text-decoration: none;">
                                <a href="https://d3vilbug.github.io/posts/aes_killer---usage-guide/">= AES Killer - Usage Guide</a>
                            </li>
                        
                    
                
            
            
                
                
                        
                
                        
                
                        
                
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/d3vilbug">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://www.linkedin.com/in/d3vilbug/">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="X" href="https://twitter.com/d3vilbug">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" viewBox="0 0 512 472.799">
            <path fill="currentColor" d="M403.229 0h78.506L310.219 196.04 512 462.799H354.002L230.261 301.007 88.669 462.799h-78.56l183.455-209.683L0 0h161.999l111.856 147.88L403.229 0zm-27.556 415.805h43.505L138.363 44.527h-46.68l283.99 371.278z"/>
        </svg>
    </a>





    <a target="_blank" class="social" title="Discord" href="https://discord.com/users/711500317291708416">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19.27 5.33C17.94 4.71 16.5 4.26 15 4a.09.09 0 0 0-.07.03c-.18.33-.39.76-.53 1.09a16.09 16.09 0 0 0-4.8 0c-.14-.34-.35-.76-.54-1.09c-.01-.02-.04-.03-.07-.03c-1.5.26-2.93.71-4.27 1.33c-.01 0-.02.01-.03.02c-2.72 4.07-3.47 8.03-3.1 11.95c0 .02.01.04.03.05c1.8 1.32 3.53 2.12 5.24 2.65c.03.01.06 0 .07-.02c.4-.55.76-1.13 1.07-1.74c.02-.04 0-.08-.04-.09c-.57-.22-1.11-.48-1.64-.78c-.04-.02-.04-.08-.01-.11c.11-.08.22-.17.33-.25c.02-.02.05-.02.07-.01c3.44 1.57 7.15 1.57 10.55 0c.02-.01.05-.01.07.01c.11.09.22.17.33.26c.04.03.04.09-.01.11c-.52.31-1.07.56-1.64.78c-.04.01-.05.06-.04.09c.32.61.68 1.19 1.07 1.74c.03.01.06.02.09.01c1.72-.53 3.45-1.33 5.25-2.65c.02-.01.03-.03.03-.05c.44-4.53-.73-8.46-3.1-11.95c-.01-.01-.02-.02-.04-.02zM8.52 14.91c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.84 2.12-1.89 2.12zm6.97 0c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.83 2.12-1.89 2.12z"/>
        </svg>
    </a>









    <a target="_blank" class="social" title="RSS Feed" href="https://d3vilbug.github.io/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>





        <p class="footnote">

</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://d3vilbug.github.io/posts/aes-killer---mobile-app-demo/">Decrypting Mobile App Traffic using AES Killer and Frida</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2021-04-19T00:00:00Z" class="post-date">
        April 19, 2021
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>5 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-burp">
        <a href="https://d3vilbug.github.io/tags/burp">burp</a>
      </li>
      
      <li class="tag-aes-killer">
        <a href="https://d3vilbug.github.io/tags/aes-killer">aes-killer</a>
      </li>
      
      <li class="tag-burp-plugin">
        <a href="https://d3vilbug.github.io/tags/burp-plugin">burp-plugin</a>
      </li>
      
      <li class="tag-java">
        <a href="https://d3vilbug.github.io/tags/java">java</a>
      </li>
      
      <li class="tag-burpsuite">
        <a href="https://d3vilbug.github.io/tags/burpsuite">burpsuite</a>
      </li>
      
      <li class="tag-burpsuite-tools">
        <a href="https://d3vilbug.github.io/tags/burpsuite-tools">burpsuite-tools</a>
      </li>
      
      <li class="tag-burpsuite-plugin">
        <a href="https://d3vilbug.github.io/tags/burpsuite-plugin">burpsuite-plugin</a>
      </li>
      
      <li class="tag-burp-extension">
        <a href="https://d3vilbug.github.io/tags/burp-extension">burp-extension</a>
      </li>
      
      <li class="tag-decryptor">
        <a href="https://d3vilbug.github.io/tags/decryptor">decryptor</a>
      </li>
      
      <li class="tag-aes-encryption">
        <a href="https://d3vilbug.github.io/tags/aes-encryption">aes-encryption</a>
      </li>
      
      <li class="tag-mobilesecurity">
        <a href="https://d3vilbug.github.io/tags/mobilesecurity">mobilesecurity</a>
      </li>
      
      <li class="tag-applicationsecurity">
        <a href="https://d3vilbug.github.io/tags/applicationsecurity">applicationsecurity</a>
      </li>
      
      <li class="tag-frida">
        <a href="https://d3vilbug.github.io/tags/frida">frida</a>
      </li>
      
    </ul>
    
  </div>

  
  

  
</div>

  <p>In this post, I&rsquo;ll be discussing how to decrypt the mobile app AES Encrypted traffic on the fly using AES Killer.</p>
<h2 id="pre-requisites">Pre-requisites</h2>
<ul>
<li>Familiarity with Frida and hooking</li>
<li>Familiarity with Burpsuite and Genymotion</li>
</ul>
<h2 id="requirements-and-setup">Requirements and Setup</h2>
<ul>
<li>
<p>11x256 demo app and server</p>
<ul>
<li><a href="https://github.com/11x256/frida-android-examples/tree/master/examples/5/app-release.apk" target=_blank>Android App</a></li>
<li><a href="https://github.com/11x256/frida-android-examples/blob/master/examples/5/node%20js%20server/node%20js%20server.js" target=_blank>NodeJS</a> Web Server</li>
</ul>
</li>
<li>
<p>Frida</p>
<ul>
<li>Frida on Local machine, can be installed using <code>pip install frida</code></li>
<li>Frida Server on Android device, download latest version from <a href="https://github.com/frida/frida/releases" target=_blank>GitHub Releases</a></li>
</ul>
</li>
<li>
<p>Burpsuite</p>
</li>
<li>
<p>AES Killer latest jar from <a href="https://github.com/Ebryx/AES-Killer/releases/tag/v4.0" target=_blank>GitHub Releases</a></p>
</li>
<li>
<p>Genymotion Emulator</p>
</li>
</ul>
<p>The required scripts and the applictaion can also be found on <a href="https://github.com/d3vilbug/demo-example-code-snippets/tree/master/AES_Killer%20-%20Mobile%20App%20Demo" target=_blank>AES_Killer - Mobile App Demo</a>.</p>
<h2 id="setting-up-api-server">Setting up API Server</h2>
<p>Downloaded the <a href="https://github.com/d3vilbug/demo-example-code-snippets/blob/master/AES_Killer%20-%20Mobile%20App%20Demo/node%20js%20server/nodejs-server.js" target=_blank>nodejs-server.js</a> and run it using node</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ node nodejs-server.js 
</span></span><span style="display:flex;"><span>NodeJS server started on port 127.0.0.1:1337 .......
</span></span></code></pre></div><p>Now the API server is running on our localhost port 1337</p>
<h2 id="capturing-the-application-traffic">Capturing the Application Traffic</h2>
<p>Install the application using ADB or by drag and drop. Once installed, launch the application and you&rsquo;ll see the following screen.</p>
<img src="https://i.imgur.com/Ye9rBNX.png">
<p>This application is compiled with URL http://192.168.18.134 so we need to make a little change in our burp proxy to redirect all requests to our 127.0.0.1:1337.</p>
 <img src="https://i.imgur.com/hrBb8DX.png">
<p>Now type any username and press the <strong>Button</strong> to send a request. The application will send an encrypted request to our local server as shown below. Also, in response getting an encrypted string.</p>
<img src="https://i.imgur.com/pr8uLv8.gif">
<p>Now let&rsquo;s move on to getting the encryption keys and understanding the encryption &amp; decryption mechanism.</p>
<h2 id="getting-encryption-keys-using-frida">Getting Encryption Keys using Frida</h2>
<p>One way of getting the encryption keys is to Reverse Engineering the application and analyze its source code but if the application is obfuscated then understanding the source code becomes relatively hard. So we&rsquo;ll be skipping the Reverse Engineering part as we already have application <a href="https://github.com/d3vilbug/demo-example-code-snippets/blob/master/AES_Killer%20-%20Mobile%20App%20Demo/android/my_activity.java" target=_banlk>source code</a> and below is the code segment from the encryption method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String pre_shared_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;aaaaaaaaaaaaaaaa&#34;</span>; <span style="color:#75715e">//assume that this key was not hardcoded</span>
</span></span><span style="display:flex;"><span>String generated_iv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bbbbbbbbbbbbbbbb&#34;</span>;
</span></span><span style="display:flex;"><span>Cipher my_cipher <span style="color:#f92672">=</span> Cipher.<span style="color:#a6e22e">getInstance</span>(<span style="color:#e6db74">&#34;AES/CBC/PKCS5PADDING&#34;</span>);
</span></span><span style="display:flex;"><span>my_cipher.<span style="color:#a6e22e">init</span>(Cipher.<span style="color:#a6e22e">ENCRYPT_MODE</span>, <span style="color:#66d9ef">new</span> SecretKeySpec(pre_shared_key.<span style="color:#a6e22e">getBytes</span>(<span style="color:#e6db74">&#34;UTF-8&#34;</span>), <span style="color:#e6db74">&#34;AES&#34;</span>), <span style="color:#66d9ef">new</span> IvParameterSpec(generated_iv.<span style="color:#a6e22e">getBytes</span>(<span style="color:#e6db74">&#34;UTF-8&#34;</span>)));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> x <span style="color:#f92672">=</span> my_cipher.<span style="color:#a6e22e">doFinal</span>(data.<span style="color:#a6e22e">getBytes</span>());
</span></span></code></pre></div><p>And we can see that the application is using <code>AES/CBC/PKCS5PADDING</code> encryption using Secret Key <code>aaaaaaaaaaaaaaaa</code> and IV Parameter <code>bbbbbbbbbbbbbbbb</code> but we&rsquo;ll also retrieve all these values by hooking java native crypto methods using Frida.</p>
<p>We&rsquo;ll be using <a href="https://github.com/d3vilbug/demo-example-code-snippets/blob/master/AES_Killer%20-%20Mobile%20App%20Demo/frida-hook.py" target=_blank>frida-hook,py</a> python script to load and execute our JS code using frida</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> frida
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_message</span>(a, b):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;on message ....... &#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>device <span style="color:#f92672">=</span> frida<span style="color:#f92672">.</span>get_usb_device()
</span></span><span style="display:flex;"><span>pid <span style="color:#f92672">=</span> device<span style="color:#f92672">.</span>spawn([<span style="color:#e6db74">&#34;com.example.a11x256.frida_test&#34;</span>])
</span></span><span style="display:flex;"><span>device<span style="color:#f92672">.</span>resume(pid)
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>) 
</span></span><span style="display:flex;"><span>session <span style="color:#f92672">=</span> device<span style="color:#f92672">.</span>attach(pid)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># session = frida.get_usb_device().attach(&#39;com.example.a11x256.frida_test&#39;)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;aes-hook.js&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    script <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>create_script(f<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>script<span style="color:#f92672">.</span>on(<span style="color:#e6db74">&#34;message&#34;</span>, on_message)
</span></span><span style="display:flex;"><span>script<span style="color:#f92672">.</span>load()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sys<span style="color:#f92672">.</span>stdin<span style="color:#f92672">.</span>read()
</span></span></code></pre></div><p>We can use this <a href="https://github.com/d3vilbug/demo-example-code-snippets/blob/master/AES_Killer%20-%20Mobile%20App%20Demo/aes-hook.js" target=_blank>aes-hook.js</a> to hook all related methods. We can use the below code snippet to directly hook the Secret Key and IV Parameter constructors so whenever the application initializes the object, we&rsquo;ll get our Secret Key and IV.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">secretKeySpec</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;javax.crypto.spec.SecretKeySpec&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">secretKeySpec</span>.<span style="color:#a6e22e">$init</span>.<span style="color:#a6e22e">overload</span>(<span style="color:#e6db74">&#39;[B&#39;</span>, <span style="color:#e6db74">&#39;java.lang.String&#39;</span>).<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$init</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;================= SecretKeySpec =====================&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;SecretKeySpec :: bytesToString :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToString</span>(<span style="color:#a6e22e">a</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;SecretKeySpec :: bytesToBase64 :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToBase64</span>(<span style="color:#a6e22e">a</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;SecretKeySpec :: bytesToBase64 :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToHex</span>(<span style="color:#a6e22e">a</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ivParameterSpec</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;javax.crypto.spec.IvParameterSpec&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ivParameterSpec</span>.<span style="color:#a6e22e">$init</span>.<span style="color:#a6e22e">overload</span>(<span style="color:#e6db74">&#39;[B&#39;</span>).<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">a</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$init</span>(<span style="color:#a6e22e">a</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;\n================== IvParameterSpec ====================&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;IvParameterSpec :: bytesToString :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToString</span>(<span style="color:#a6e22e">a</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;IvParameterSpec :: bytesToBase64 :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToBase64</span>(<span style="color:#a6e22e">a</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;IvParameterSpec :: bytesToBase64 :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToHex</span>(<span style="color:#a6e22e">a</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Or we can hook <code>Cipher.init()</code> method too to get the Secret Key and IV Parameter using this code segment.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cipher</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;javax.crypto.Cipher&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cipher</span>.<span style="color:#a6e22e">init</span>.<span style="color:#a6e22e">overload</span>(<span style="color:#e6db74">&#39;int&#39;</span>, <span style="color:#e6db74">&#39;java.security.Key&#39;</span>, <span style="color:#e6db74">&#39;java.security.spec.AlgorithmParameterSpec&#39;</span>).<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">init</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;\n================ cipher.init() ======================&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">N_ENCRYPT_MODE</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;1&#39;</span>) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;init :: Encrypt Mode&#34;</span>);    
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">N_DECRYPT_MODE</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;2&#39;</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;init :: Decrypt Mode&#34;</span>);    
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Mode :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">a</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Secret Key :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToHex</span>(<span style="color:#a6e22e">b</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Secret Key :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToBase64</span>(<span style="color:#a6e22e">b</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;IV Param :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToHex</span>(<span style="color:#a6e22e">c</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;IV Param :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToBase64</span>(<span style="color:#a6e22e">c</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And if we want to observe data encryption and decryption on runtime, we have to hook <code>Cipher.doFinal()</code> method for that.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cipher</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;javax.crypto.Cipher&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cipher</span>.<span style="color:#a6e22e">doFinal</span>.<span style="color:#a6e22e">overload</span>(<span style="color:#e6db74">&#34;[B&#34;</span>).<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">x</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;\n================ doFinal() ======================&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ret</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cipher</span>.<span style="color:#a6e22e">doFinal</span>.<span style="color:#a6e22e">overload</span>(<span style="color:#e6db74">&#34;[B&#34;</span>).<span style="color:#a6e22e">call</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">x</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;doFinal :: data to encrypt/decrypt - base64 :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToBase64</span>(<span style="color:#a6e22e">x</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;doFinal :: data ro encrypt/decrypt - string :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">bytesToString</span>(<span style="color:#a6e22e">x</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;doFinal :: data ro encrypt/decrypt - return value :: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ret</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ret</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="hooking-with-frida">Hooking with Frida</h2>
<p>Now run the python script to launch the application and execute our JS code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ python frida-hook.py 
</span></span><span style="display:flex;"><span>Script loaded successfully ..... 
</span></span></code></pre></div><img src="https://i.imgur.com/Bwi17Bb.gif">
<p>Our JS Code is successfully loaded now, lets send a request by pressing the <strong>Button</strong>.</p>
<img src="https://i.imgur.com/UEpSXDX.gif">
<p>And if we only want to observe runtime data encrypted and decryption, comment the rest of the code except  <code>cipher.doFinal</code> method from our js file.</p>
<img src="https://i.imgur.com/9oT0iKb.gif">
<pre>
For iOS please use <a href="https://github.com/noobpk/frida-ios-hook" target=_blank>Frida iOS Hook</a> to get AES Secret Key and IV
</pre>
<h2 id="configuring-aes-killer">Configuring AES Killer</h2>
<p>Now that we have our Secret Key, IV Parameter and Encryption method from Frida hooking too</p>
<ul>
<li>
<p>Cipher - <code>AES/CBC/PKCS5PADDING</code></p>
</li>
<li>
<p>Secret Key - <code>YWFhYWFhYWFhYWFhYWFhYQ==</code> which is base64 of <code>aaaaaaaaaaaaaaaa</code></p>
</li>
<li>
<p>IV Parameter - <code>YmJiYmJiYmJiYmJiYmJiYg==</code> which is base64 of <code>bbbbbbbbbbbbbbbb</code></p>
</li>
<li>
<p>As the application is sending complete request body encrypted, so we&rsquo;ll select <code>Complete Request Body</code> from <strong>Request Options</strong></p>
</li>
<li>
<p>The application is getting encrypted string in response, so we&rsquo;ll select <code>Complete Response Body</code> from <strong>Response Options</strong></p>
</li>
<li>
<p>Host - http://127.0.0.1:1337</p>
</li>
<li>
<p>Now Press <code>Start AES Killer</code></p>
</li>
</ul>
<img src="https://i.imgur.com/FRl1DYB.gif">
<h2 id="decrypting-the-application-traffic-using-aes-killer">Decrypting the Application Traffic using AES Killer</h2>
<p>Upon starting AES Killer, we can observe that the Burp has started to show us decrypted traffic while Burp sending encrypted traffic to the application and server.</p>
<img src="https://i.imgur.com/JfrH65u.gif">
<h2 id="aes-killer-with-repeater-intruder-and-scanner">AES Killer with Repeater, Intruder and Scanner</h2>
<p>Once we start AES Killer, it takes control of Burp <code>IHttpListener.processHttpMessage</code> which is responsible for handling all outgoing and incoming traffic and AES Killer do the following</p>
<ul>
<li>Before sending the final request to a server, <code>ProcessHttpMessage</code> encrypt the request</li>
<li>Upon receiving a response,  <code>ProcessHttpMessage</code> decrypt the response first before showing it to us</li>
</ul>
<p>So we&rsquo;ll only be getting the Plain Text Response and can play with Plain Text request.</p>
<img src="https://i.imgur.com/MVhBHcS.gif">
<h2 id="manual-encryption-and-decryption">Manual Encryption and Decryption</h2>
<p>We can also manually encrypt and decrypt strings using AES Killer. Let&rsquo;s take an encrypted string from the request <code>TYROd49FWJjYBfv02oiUzwRQgxWMWiw4W3oCqvNf8h3bnb7X0bobypFzMt797CYU</code> and decrypt it using AES Killer. Similarly, we can perform the encryption too.</p>
<img src="https://i.imgur.com/rjWDACt.gif">

  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://d3vilbug.github.io/posts/aes_killer---usage-guide/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>AES Killer - Usage Guide</a>
        
	    
            <div class="next-post">
                <a href="https://d3vilbug.github.io/posts/sreplay/?ref=footer"><span style="font-weight:bold;">Next »</span><br>SRePlay - Replay Protection Bypass</a>
            </div>
        
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#pre-requisites">Pre-requisites</a></li>
    <li><a href="#requirements-and-setup">Requirements and Setup</a></li>
    <li><a href="#setting-up-api-server">Setting up API Server</a></li>
    <li><a href="#capturing-the-application-traffic">Capturing the Application Traffic</a></li>
    <li><a href="#getting-encryption-keys-using-frida">Getting Encryption Keys using Frida</a></li>
    <li><a href="#hooking-with-frida">Hooking with Frida</a></li>
    <li><a href="#configuring-aes-killer">Configuring AES Killer</a></li>
    <li><a href="#decrypting-the-application-traffic-using-aes-killer">Decrypting the Application Traffic using AES Killer</a></li>
    <li><a href="#aes-killer-with-repeater-intruder-and-scanner">AES Killer with Repeater, Intruder and Scanner</a></li>
    <li><a href="#manual-encryption-and-decryption">Manual Encryption and Decryption</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
